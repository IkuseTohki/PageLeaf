# ADR-0003: CSSプロパティにおける「未設定（Unset）」の扱いとデフォルト値の管理

## ステータス

承認済み (Accepted)

## 背景

これまで、CSSの数値プロパティ（フォントサイズ等）は、未設定の場合に内部的に `0` として扱われていた。
しかし、CSSにおいては「プロパティが存在しない（ブラウザのデフォルトに従う）」ことと「値が0である」ことは意味が異なる。
また、UI上でも未設定時は「0」ではなく「空欄」であることが望ましく、空欄から値を設定する際には「0」ではなく「プロパティごとの妥当なデフォルト値」から開始したいという要望がある。

現在、これらのデフォルト値や単位の設定がXAML（View）内にハードコードされており、保存ロジック（Service）との整合性が取れず、テスタビリティも低い状態にある。

## 決定事項

1. **データ型の変更**:
   - CSSの値を保持するModel/ViewModelのプロパティ（数値）は、`Nullable<double>` (`double?`) を使用する。
   - `null` は「CSSプロパティが出力されない状態（Unset）」を表す。

2. **デフォルト値の責務移動**:
   - 各セレクタ・プロパティごとの「デフォルト値」および「デフォルト単位」の定義は、XAMLから排除し、C#コード（Model層の定義クラス `CssDefaults`）へ移動する。
   - Viewからの参照は、`x:Static` によるModel直接参照ではなく、ViewModel経由で行うことでMVVMの原則を遵守する。

3. **UI挙動の統一**:
   - **表示**: 値が `null` の場合、テキストボックスは空欄とする。
   - **単位**: 値が `null` であっても、定義された「デフォルト単位」を表示する。
   - **スピナー操作**: 値が空欄の状態で操作した場合、`0` ではなく、定義された「デフォルト値」を初期値として値を設定する。

4. **CSS仕様への準拠**:
   - 行間（`line-height`）などのプロパティは、単位なし（倍率指定）をデフォルトとする。

5. **保存挙動**:
   - 値が `null` （未設定）のプロパティは、CSS生成時に出力しない。

## 影響範囲

- `CssStyleProfile` および関連するElementクラス (`HeadingStyle` 等) のプロパティ型変更。
- `CssNumericEditorControl` のバインディング修正と、スピナーロジックへの「デフォルト値」依存性の注入。
- `CssEditorService` のパースおよび生成ロジックの修正。

## 備考

これにより、ユーザーは「設定なし」と「0を設定」を明確に使い分けることができ、予期せぬスタイル上書き（意図せず font-size: 0px が出力される等）を防ぐことができる。
