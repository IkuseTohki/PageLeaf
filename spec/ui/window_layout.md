# UI 仕様：画面構成・レイアウト

## 1. メインウィンドウ

アプリケーションの主要機能を統合したメインインターフェースを構成する。執筆とスタイル調整をシームレスに行えるよう、各要素を論理的に配置する。

### 1.1. メニューバー

ファイル操作、環境設定、およびユーザー支援リソースへのアクセスを一元化する。

- **ファイル**: 新規作成、開く、保存、別名で保存、終了などのファイルライフサイクル操作を配置する
- **設定**: モーダル形式の設定画面を表示する
- **ヘルプ**: バージョン情報およびモードレスなチートシートを表示する

### 1.2. 表示・編集エリア

画面中央の広範な領域を占め、Markdown の編集とプレビュー表示を担う。

- **コンテンツエリア**: AvalonEdit（編集時）および WebView2（プレビュー時）を、ユーザーが選択した表示モードに応じて動的に切り替えて表示する

#### 1.2.1. オーバーレイボタンの仕様

プレビュー表示（WebView2）の描画領域を最大限に活用しつつ、常に主要な操作系へアクセスできるよう、コンテンツエリアの右上にフローティング形式のボタン群を配置する。このボタン群は、ビューアー領域を阻害しないよう通常時は半透明の背景として配置し、マウスオーバー時に不透明度を上げ、インタラクションを強調する。

技術的には、WebView2 コントロールの前面に WPF コンテンツを表示する際の干渉（Airspace 問題）を回避するため、特殊なレイヤー構造（Popup 等の活用）を採用し、描画の正確性を担保する。これにより、現在の表示モードが編集か閲覧かにかかわらず、常にボタン群が最前面に維持され、ユーザーはいつでも迷わずにモード切替やナビゲーションを実行できるものとする。

#### 1.2.2. 配置される機能

オーバーレイボタン群には、以下の主要な表示制御アクションを集約する。

- **表示モード切替**: 編集モード（Markdown）と閲覧モード（Viewer）を 1 クリックで切り替える。現在の状態（IsDirty 等）を示すインジケータもアイコンに包含する
- **目次 (TOC) 表示**: 文書構造から自動生成された目次をポップアップ表示し、特定セクションへの迅速なジャンプを提供する

### 1.3. サイドパネル（右側）

CSS 編集およびメタデータ管理を集約する。不要な場合はサイドパネル全体を折りたたみ、エディタ領域を拡大できるものとする。

- **CSS 編集パネル**: CSS ファイルの管理（新規・切替・保存）と、カテゴリ別の詳細なスタイル編集インターフェースを提供する
- **フロントマター編集パネル**: ファイル冒頭の YAML メタデータを解析し、キー・バリュー形式による直接編集を可能とする

## 2. 設定画面（モーダル）

アプリケーションの動作環境を定義する独立したウィンドウとする。ユーザーが設定作業に集中できるよう、情報の階層を整理した二ペインレイアウトを採用する。

### 2.1. ウィンドウ構造とナビゲーション

画面左側にカテゴリ選択用のサイドバー（幅 200px）を、右側に詳細な設定フォームを配置する垂直分割構成とする。
サイドバーには「外観」「エディタ」「画像・ファイル」といった各カテゴリのタブボタンを配置し、選択に応じて右側のコンテンツを動的に切り替える。これにより、多数の設定項目を目的別に整理し、ユーザーの認知負荷を軽減させる。

### 2.2. 下部アクションエリア

ウィンドウ最下部には「保存」および「キャンセル」のアクションボタンを右寄せで固定配置する。このエリアはコンテンツのスクロールにかかわらず常に表示され、ユーザーがいつでも設定の確定または破棄を行えるようにする。

### 2.3. カテゴリ別設定項目（索引）

各カテゴリ内に配置される主要な設定要素を以下に定める。

- **外観・表示**: テーマ選択（システム/ライト/ダーク）、ライブラリ取得元の切り替え、およびシンタックスハイライトテーマの設定
- **エディタ・執筆**: エディタのフォントサイズ、インデント幅（スペース/タブ）、および脚注のリナンバリング設定
- **ファイル・データ**: 画像貼り付け時の保存ディレクトリ規則、およびフロントマターの自動挿入テンプレート定義
- **診断・ログ**: ログ出力レベルの選択、およびファイル出力の有効・無効設定

## 3. チートシート（モードレス）

執筆を支援するためのリファレンス情報を提示する補助ウィンドウとする。メインウィンドウとの並行作業を可能にするため、モードレス（非独占的）な表示形式を採用する。

- **構成**: Markdown 記法のリファレンスと、アプリ固有のショートカットキー一覧をタブで切り替える構造とする
- **挙動**: すでにウィンドウが開いている状態で再呼び出しされた場合は、新規生成せず既存のウィンドウを最前面へ移動（Activate）させる

## 4. ウィンドウ制約と状態管理

システムの安定稼働とユーザーの利便性を維持するための物理的制約を定める。

### 4.1. 物理的サイズ制約

情報の欠落や UI の崩れを防ぐため、各ウィンドウに適切なサイズ制約を設ける。

- **メインウィンドウ**: 最小サイズを **1000 x 600 px**（初期値に準拠）に制限し、主要なパネルの視認性を確保する
- **設定画面**: レイアウトの整合性を維持するため、**680 x 500 px** の固定サイズとし、ユーザーによるリサイズを禁止する

### 4.2. 状態の永続化

ユーザーが調整したウィンドウの状態を記憶し、次回起動時に前回の作業環境を再現する。

- **レイアウト維持**: サイドパネルの幅設定や、メインウィンドウの最終的な位置・サイズを永続化し、復元する
- **モーダル制御**: 設定画面などのモーダル表示時はメインウィンドウ側の操作をブロックし、ユーザーの注意を逸らさないように制御する
