# Markdown エディタ・ビューア 仕様書

## 1. 概要

本アプリケーションは、Markdown ファイルの編集、表示、および各種形式へのエクスポート機能を提供するデスクトップアプリケーションである。ユーザーは直感的なインターフェースを通じて Markdown コンテンツを効率的に管理できる。

## 2. 機能要件

### 2.1. ファイル操作

- **新規作成**: 新しい Markdown ファイルを作成する。
- **ファイル選択**: ファイルダイアログを通じて、既存の Markdown ファイル（.md, .markdown など）を開く。
- **フォルダ選択**: フォルダを指定して開き、ツリー表示する。
- **保存**: 編集中の Markdown ファイルの内容を保存する。

### 2.2. 編集機能

- **Markdown 編集**: ユーザーはメイン表示・編集エリアで Markdown テキストを直接入力、編集できる。
- **モード切り替え**: 以下の 3 つのモードを切り替えることができる。
  - **ビューアーモード**: CSS を適用した閲覧専用モード。Markdown テキストは HTML として表示され、編集はできない。
  - **Markdown 編集モード**: Markdown テキストを表示し、直接編集できるモード。
  - **リアルタイム編集モード**: CSS を適用した HTML 表示だが、カーソルのある行だけ Markdown 形式で表示され、編集できるモード。カーソルが移動すると、その行は再度 HTML 表示に戻る。

### 2.3. 表示機能

- **メイン表示・編集エリア**: 選択された Markdown ファイル、または編集中の Markdown テキストを、現在のモードに応じて表示する。
- **フォルダツリー表示**: フォルダを開いた場合、左右どちらか（設定で変更可能）にフォルダツリーを表示する。ツリーで選択したファイルの内容をメイン表示・編集エリアに表示する。
  - **折りたたみ機能**: フォルダツリーは、各フォルダのノードを折りたたんだり展開したりできる機能を持つ。
- **外部ファイル変更検知**: 表示中の Markdown ファイルが外部で変更された場合、自動的に内容を再読み込みし、表示を更新する。
- **CSS 切り替え**:
  - ユーザーはプルダウンメニューから適用する CSS スタイルを選択し、メイン表示・編集エリア（ビューアーモード、リアルタイム編集モード時）のスタイルを動的に変更できる。
  - アプリケーション起動時に、特定のディレクトリ（例: `styles/`）から利用可能な CSS ファイルを読み込み、プルダウンメニューにリスト表示する。

### 2.4. エクスポート機能

編集中の Markdown コンテンツ、または表示中の Markdown コンテンツを以下の形式でエクスポートできる。

- **HTML**: Markdown を HTML 形式でエクスポートする。
- **PDF**: Markdown を PDF 形式でエクスポートする。
- **Word (docx)**: Markdown を Microsoft Word (docx) 形式でエクスポートする。
- **画像 (PNG)**: Markdown の表示内容を画像 (PNG) 形式でエクスポートする。

## 3. 画面構成

### 3.1. メインウィンドウ

- **ツールバー**:
  - **CSS 選択プルダウン**: メイン表示・編集エリアに適用する CSS スタイルを選択するためのドロップダウンリスト。
  - **モード切り替え UI**: ビューアーモード、Markdown 編集モード、リアルタイム編集モードを切り替えるための UI（例: ラジオボタン、タブ、ドロップダウン）。
- **フォルダツリー**: フォルダを開いた場合に表示されるツリービュー。
- **メイン表示・編集エリア**: Markdown テキストの表示および編集を行う単一のコンポーネント。現在のモードに応じて表示内容と編集挙動が変化する。

### 3.2. 設定画面

- **目的**: アプリケーションの各種設定を行う画面。
- **機能**:
  - フォルダツリーの表示位置（左/右）の設定。
  - その他のアプリケーション設定（将来的な拡張を考慮）。
- **永続化**: 設定内容はアプリケーション終了後も保持される。

## 4. 採用技術

- **開発言語**: C#
- **フレームワーク**: WPF (.NET Core)
- **デザインパターン**: MVVM

## 5. その他

- **文字コード**: ファイルの読み書きは UTF-8 を基本とする。
- **エラーハンドリング**: ファイルの読み込み失敗や、サポートされていないファイル形式が選択された場合には、適切なエラーメッセージをユーザーに表示する。
- **設定の永続化**: ユーザーが選択した CSS スタイルやモードなどの設定は、アプリケーション終了後も保持される。
