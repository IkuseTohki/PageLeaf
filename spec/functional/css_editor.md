# 機能仕様：CSS 編集・管理

## 1. 概要

本機能は、Markdown の各要素（見出し、段落、リスト等）に対応する CSS スタイルを、プログラムの知識がなくても GUI 上で直感的にカスタマイズできる機能である。編集内容はリアルタイムでプレビュー（ビューアーモード）に反映される。

## 2. カテゴリ別編集項目

右側の CSS 編集パネルはタブ分けされており、以下の項目を編集できる。

### 2.1. タイトル (Title)

フロントマターの `title` がプレビュー表示されている場合に適用される。

- **位置揃え**: 左寄せ、中央寄せ、右寄せ。
- **段落下の余白**: 下方向の margin。

### 2.2. 見出し (Heading)

H1 〜 H6 のレベルを選択して個別に編集可能。

- **サイズ**: フォントサイズ。
- **色**: 文字色（カラーピッカー）。
- **太字**: bold 設定の ON/OFF。
- **位置揃え**: 左寄せ、中央寄せ、右寄せ。
- **段落下の余白**: 下方向の margin。
- **項番の自動採番**: 見出しに対する自動ナンバリング（1., 1.1...）の有効化。

### 2.3. 段落 (Paragraph)

- **サイズ**: 基本フォントサイズ。
- **色**: 文字色。
- **位置揃え**: 左寄せ、中央寄せ、右寄せ、両端揃え。
- **段落下の余白**: 下方向の margin。
- **行頭インデント**: 1行目の字下げ量。

### 2.4. リスト (List)

- **マーカー設定**:
  - **箇条書き (ul)**: disc (黒丸), circle (白丸), square (四角), none。
  - **番号付き (ol)**: decimal (数字), lower-alpha (小文字アルファベット), upper-roman (大文字ローマ数字) 等。
- **フォントサイズ**: マーカーおよびリスト全体の文字サイズ。
- **レイアウト設定**: インデント幅。

### 2.5. 表 (Table)

- **罫線設定**:
  - 線の太さ。
  - 線の色。
  - 線の種類 (実線、点線、破線)。
- **セル内余白**: padding。

### 2.6. 引用 (BlockQuote)

- **フォント設定**: サイズ、文字色。
- **背景色**: 引用ブロック全体の背景色。
- **左枠線**: 引用を示す左側の線の色。
- **段落下の余白**: 下方向の margin。

### 2.7. コード (Code)

- **フォントサイズ**: コードブロック内の文字サイズ。
- **背景色**: コードブロック全体の背景色。
- **段落下の余白**: 下方向の margin。
  ※シンタックスハイライトのテーマ自体は「設定画面」で管理する。

### 2.8. 脚注 (Footnote)

- **参照マーカー**: 本文中の `[^1]` の色、太字設定、括弧 `[]` の有無。
- **注釈エリア**: エリア全体の文字サイズ、色、上部の区切り線のスタイル。
- **リストアイテム**: 行間 (line-height)、戻るリンク (`↩`) の表示/非表示。

---

## 3. 数値入力と単位管理 (Unit System)

### 3.1. 共通コントロール (`CssNumericEditorControl`)

- **一体型デザイン**: 数値入力欄、増減ボタン（スピナー）、単位選択ドロップダウンが統合されている。
- **ミニマル表示**: スピナーおよびドロップダウンの矢印は、マウスオーバー時のみ表示される。
- **入力制限**: px や % 指定時は整数のみ、em 指定時は小数点入力を許容する。また、原則として負の値は入力できない。
- **未設定値の扱い**:
  - 値が設定されていない場合、入力欄は空欄となる。
  - **保存時の挙動**: 空欄の項目は CSS ファイルに出力されない（プロパティ自体が生成されない）。これにより、ブラウザのデフォルトスタイルや継承値を尊重できる。
  - **編集時の挙動**: 空欄の状態でスピナーを操作した場合、`0` ではなく、各プロパティごとに定義された「デフォルト値（推奨値）」を初期値として入力が開始される。
  - **単位表示**: 値が空欄であっても、そのプロパティに適したデフォルトの単位（例: `em`）が表示される。

### 3.2. 単位変換ロジック

単位（px, em, %）を切り替えた際、見た目の大きさを維持するために数値を自動変換する。

- **基準値**: 16px を 1.0em / 100% として計算する。
- **変換例**:
  - `16px` → `em` に変更 → `1.0em`
  - `1.5em` → `px` に変更 → `24px`
- **非対応単位**: 直接入力でサポート外の単位が指定された場合は、自動変換を行わない。

---

## 4. 状態管理とフィードバック

### 4.1. 未保存変更の検知 (Dirty Check)

- **カテゴリ別検知**: 変更があったカテゴリのタブアイコンの左上に、ドットインジケータを表示する。
- **全体検知**: CSS パネル上部の「保存」ボタンの有効化、およびメイン画面のモード切替ボタンへの通知。

### 4.2. リセット機能

- **動作**: 現在の編集内容をすべて破棄し、最後に保存された（またはファイルに記述されている）状態に復元する。
- **確認**: 大幅な変更がある場合は、実行前に確認ダイアログを表示する。

---

## 5. 実装・同期仕様

### 5.1. CSS パースと更新

- **初期ロード**: CSS ファイルを `ExCSS` ライブラリで解析し、各要素のプロパティを GUI の各項目にマッピングする。
- **動的更新**: GUI で値を変更するたび、メモリ上の `IStyleSheet` を更新し、プレビュー用の HTML へ反映する。
- **保存**: 設定されている全項目を CSS ルールとして書き出す。GUI で設定していないプロパティについては、既存の CSS 記述がある場合はそれを維持する（手書き CSS の尊重）。

### 5.2. CSS 管理

- **新規作成**: CSS 選択ドロップダウンから新しいファイル名を入力して作成可能。
- **切り替え**: ドロップダウンでファイルを選択すると、即座にその CSS が解析され、GUI とプレビューの両方が更新される。
