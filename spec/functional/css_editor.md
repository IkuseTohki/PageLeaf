# 機能仕様：CSS 編集・管理

## 1. 概要

本機能は、Markdown の各要素（見出し、段落、リスト等）に対応する CSS スタイルを、プログラムの知識がなくても GUI 上で直感的にカスタマイズできる環境を提供する。ユーザーが GUI パネルで行った操作は、内部的に解析・保持し、リアルタイムでプレビュー画面（ビューアーモード）へと反映させるものとする。

## 2. カテゴリ別編集項目

右側の CSS 編集パネルは各要素ごとにタブ分けし、設定された値をユーザーCSS内の適切なセレクタのプロパティとして書き出す。各タブで編集可能な項目と、それらが影響を及ぼす CSS プロパティおよび対象要素を以下に定める。

### 2.1. タイトル (Title)

フロントマターの `title` がプレビュー表示されている場合に、`.document-title` クラスに対して適用する。

- **位置揃え (`text-align`)**: 左寄せ、中央寄せ、右寄せ
- **段落下の余白 (`margin-bottom`)**: タイトル要素下部の空間設定

### 2.2. 見出し (Heading)

H1 〜 H6 の各レベルを個別に編集可能とする。

- **基本属性**: フォントサイズ (`font-size`)、文字色 (`color`)、太字設定 (`font-weight`)
- **位置・余白**: 位置揃え (`text-align`) および下方向の余白 (`margin-bottom`)
- **自動採番**: 見出しに対する `counter-increment` を用いた自動ナンバリング (1., 1.1...) の有効化

### 2.3. 段落 (Paragraph)

本文の標準テキスト (`p` タグ) に適用する。

- **基本属性**: 文字サイズ、色、位置揃え (`text-align: justify` を含む)
- **余白・字下げ**: `margin-bottom` による段落間隔、および `text-indent` による 1 行目の字下げ量

### 2.4. リスト (List)

箇条書き (`ul`) と番号付きリスト (`ol`) の共通および個別の設定を行う。

- **マーカー設定**: 箇条書きの形状 (disc, circle, square) および番号の形式 (decimal, lower-alpha, upper-roman)
- **ol 固有設定**: 番号の後のピリオド (例: "1." ) を表示するか、番号のみにするかの切り替え
- **レイアウト**: インデント幅 (`padding-left`) および全体の文字サイズ

### 2.5. 表 (Table)

プレビュー内の `table` およびそのセル要素に適用する。

- **罫線 (`border`)**: 線の太さ、色、スタイル (solid, dashed, dotted)。これらは `border-collapse: collapse` されたテーブル全体の境界およびセル境界に適用する
- **セル内余白**: `th`, `td` に対する `padding` 指定

### 2.6. 引用 (BlockQuote)

アプリが提供する基本スタイル（デザインプリセット）の選択、および詳細な属性カスタマイズを可能とする。選択されたプリセット名はフロントマターの `quote_style` プロパティとして保存する。

#### デザインプリセット

- **Simple (横ライン)**: 左側の境界線と背景色による標準スタイル (`bq-simple`)
- **Card (カード型)**: 角丸と影を用いた独立したブロックスタイル (`bq-card`)
- **TopBottom (上下ライン)**: 上下の境界線によるクラシックなスタイル (`bq-topbottom`)
- **Modern (モダン)**: グラデーションラインや洗練されたスタイル (`bq-modern`)

#### アイコンと引用元の制御

- **アイコン制御**: 引用符アイコン（“）の表示/非表示を切り替える (`has-icon` / `no-icon` クラスの付与)
- **引用元 (Citation)**: 独自拡張 `[cite: ...]` で記述された箇所を `<cite>` タグに変換する

#### 詳細カスタマイズ

ユーザーCSSファイルにおいて、プリセットのプロパティを上書きするセレクタを記述可能とする。パネル上の各項目（文字色、背景色、枠線等）の編集内容は、このユーザーCSSに自動的に書き出す。

### 2.7. コード (Code)

インラインコード (`code`) およびコードブロック (`pre code`) の共通設定を行う。

- **属性**: 文字サイズ、およびブロック時の背景色 (`background-color`)
- **配置**: コードブロック下方向の余白 (`margin-bottom`)
  ※ シンタックスハイライトのカラーテーマ自体はシステム設定に従うが、背景色等のスタイルの枠組みはここでの設定を優先可能とする。

### 2.8. 脚注 (Footnote)

本文内の参照マーカー (`.footnote-ref`) と、最下部の注釈エリア (`.footnotes`) に適用する。

- **参照マーカー**: 色、太字、および括弧 `[]` の有無（疑似要素による制御）
- **注釈エリア**: エリア全体の文字サイズ、色、および上部の区切り線 (`hr`) のスタイル
- **アイテム**: 行間 (`line-height`)、および本文へ戻るリンク (`↩`) の表示制御

---

## 3. 数値入力と単位管理 (Unit System)

本アプリの CSS 編集では、px, em, % といった異なる単位を透過的に扱うための高度な入力支援を提供する。

### 3.1. インテリジェントな数値入力 (`CssNumericEditorControl`)

数値入力欄、増減スピナー、および単位選択ドロップダウンが統合された専用コントロールを使用する。外観はミニマルに保ち、マウスオーバー時のみ操作用の補助ボタンを表示する設計とする。
入力に際しては、選択されている単位に応じた制限（px/% 指定時は整数のみ、em 指定時は小数点許容など）を設ける。また、負の値の入力を原則として禁止することで、意図しないレイアウト崩れを未然に防ぐ。

#### 未設定値の扱いとデフォルト値の継承

値が設定されていない（空欄の）項目については、CSS ファイルへの書き出しをスキップする。これにより、ブラウザのデフォルトスタイルや上位要素からの継承値を尊重する。
空欄の状態で増減スピナーを操作した場合、各プロパティごとに定義された「推奨される初期値」を自動的に代入した状態で入力を開始するものとする。

### 3.2. 単位変換の自動追従

表示単位（px, em, %）を切り替えた際、見た目の大きさを維持するために数値を自動変換する。計算の基準値は 16px = 1.0em = 100% とし、ユーザーが現在の見た目を固定したまま柔軟に単位系を選択できるようにする。

---

## 4. 状態管理とフィードバック

ユーザーの編集状態は、カテゴリ単位および全体単位でリアルタイムに追跡する。変更が加えられたカテゴリのタブアイコンにはドットを表示し、パネル上部の「保存」ボタンを有効化する。これにより、ユーザーが編集箇所を一目で把握し、保存やリセットの判断を容易に下せるようにする。

---

## 5. 実装・同期仕様

### 5.1. CSS の動的パースとメモリ管理

初期ロード時に CSS ファイルを解析し、各要素のプロパティを GUI の各項目にマッピングする。ユーザーの操作が行われるたびにメモリ上のスタイル情報を更新し、プレビュー用の HTML へと即座に同期する。

保存時には、GUI で設定されたプロパティを優先しつつ、既存の CSS 記述がある場合はそれを極力維持して書き出す設計とし、GUI 編集と手書き CSS の共存を支援する。

### 5.2. ファイル管理と切り替え

CSS 選択ドロップダウンを通じて、複数のスタイルファイルを瞬時に切り替え可能とする。新規ファイル名の入力による作成にも対応し、作成されたファイルは即座に解析対象として読み込む。

### 5.3. Hot-Swapping (高速同期)

CSS ファイルの切り替えやスタイルの更新時、プレビュー画面全体をリロードするのではなく、HTML 内の参照先を動的に書き換える「Hot-Swapping」方式を採用する。
この手法により、フルリロードに伴う画面のチラつきを排除し、スクロール位置や要素の状態を完全に維持したまま、瞬時に新しいスタイルを反映させる。
