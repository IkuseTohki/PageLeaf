# 機能仕様：エディタ機能

## 1. 概要

本アプリケーションのエディタは、Markdown ドキュメントの執筆効率を最大化するため、モダンなコードエディタに近い操作感と入力支援を提供することを目的とする。

## 2. 基本仕様 (Core Specifications)

### 2.1. エディタエンジン

- **エンジン**: AvalonEdit (ICSharpCode.AvalonEdit) を採用。
- **文字コード**: UTF-8 (BOMなし) を標準とする。
- **基本表示**:
  - 行番号表示。
  - ウィンドウ幅に応じたワードラップ（折り返し）。
  - 設定画面で指定されたフォント・サイズを適用。

### 2.2. シンタックスハイライト

テーマ（ライト/ダーク）に応じて色が動的に切り替わる。以下の要素を構造的に認識する。

- **見出し**: `#` で始まる行。
- **コードブロック**: ` ``` ` で囲まれた範囲。
- **引用**: `>` で始まる行。
- **リスト記号**: `*`, `-`, `+`, `1.` 等で始まる行。
- **強調**: `**` (太字) または `*` (斜体) で囲まれた範囲。
- **リンク/URL**: `[text](url)` 形式の記述。

---

## 3. 入力支援機能 (Editing Support)

### 3.1. オート・コンティニュー (リスト・引用の自動継続)

改行（`Enter`）時に直前の行の構造を解析し、プレフィックスを自動挿入する。

- **箇条書き / 番号付き**: 記号を継続し、番号の場合はインクリメントする。
- **タスクリスト**: 常に未完了状態 (`- [ ] `) で継続する。
- **引用**: 引用記号 (`> `) を継続する。
- **終了挙動**: 記号のみ（コンテンツが空）の状態で改行した場合は、その行の記号を削除し、通常の空行とする。

### 3.2. オート・ペアリング (記号の自動補完)

特定の記号を入力した際、対応する閉じ記号を自動挿入する。

- **対象記号**: `(`, `[`, `{`, `"`, `'`, `` ` ``
- **選択範囲の囲み**: テキストを選択した状態でこれらの記号を入力すると、選択範囲の前後を記号で囲む。
- **閉じ記号のスキップ**: 自動補完（オート・ペアリング）によって閉じ記号が挿入された直後、ユーザーが同じ閉じ記号を入力した場合のみ、文字を挿入せずにカーソルを 1 文字右へ移動させる。カーソル移動や他の文字入力が行われた後は、このスキップ動作は無効となる。

### 3.3. テーブル編集支援

- **自動整形**: テーブル行（`|` を含む行）で `Enter` または `Tab` を押下した際、パイプ周囲のスペースを自動調整する。
- **セル間移動**: `Tab`（次へ）または `Shift + Tab`（前へ）で、隣のセルの内容を**選択状態**にしながら移動する。

### 3.4. 脚注支援

- **インライン入力**: `Ctrl + Alt + F` でカーソル直下にポップアップを表示し、参照マーカーと定義を一括挿入する。
- **番号管理**: 未使用の番号を自動採番し、保存時に出現順に自動リナンバリングする。

---

## 4. ショートカット・コマンド

| キー操作           | 機能                     | 詳細動作                                                            |
| :----------------- | :----------------------- | :------------------------------------------------------------------ |
| `Ctrl + B`         | **太字**                 | 選択範囲を `**` で囲む。                                            |
| `Ctrl + I`         | _斜体_                   | 選択範囲を `*` で囲む。                                             |
| `Ctrl + Shift + X` | ~~打ち消し線~~           | 選択範囲を `~~` で囲む。                                            |
| `Ctrl + Shift + C` | `インラインコード`       | 選択範囲を `` ` `` で囲む。                                         |
| `Ctrl + K`         | リンク挿入               | `[選択範囲]()` を作成。カーソルは `()` 内へ移動。                   |
| `Ctrl + L`         | **タスクリストのトグル** | `[ ]` (未完了) → `[x]` (完了) → `(なし)` の3段階トグル。            |
| `Ctrl + 1〜6`      | 見出しレベル変更         | 行頭にレベルに応じた `#` を付与。現在のレベルと同じなら解除。       |
| `Shift + Enter`    | 強制改ページ挿入         | 印刷用タグ `<div style="page-break-after: always;"></div>` を挿入。 |
| `Alt+Shift+←/→`    | 表示モード切替           | 編集モード(Markdown) と 閲覧モード(Viewer) を切り替える。           |

---

## 5. 特殊変換・連携機能

### 5.1. テーブル変換貼り付け

Excel等のTSV/CSVテキストを `Ctrl + V` で貼り付けた際、自動的に Markdown テーブル形式に変換する。

### 5.2. YAML フロントマター連携

ファイル冒頭の YAML ブロック（`---`）を解析し、フロントマター編集パネルとリアルタイムに同期する。詳細は [YAML フロントマター仕様](frontmatter.md) を参照。
