<UserControl x:Class="PageLeaf.Views.CssEditorView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:behaviors="clr-namespace:PageLeaf.Behaviors"
             xmlns:controls="clr-namespace:PageLeaf.Views.Controls"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:PageLeaf.ViewModels"
             d:DesignHeight="500"
             d:DesignWidth="300"
             mc:Ignorable="d">
    <UserControl.Resources>
        <Style BasedOn="{StaticResource HorizontalTabRadioButtonStyle}" TargetType="RadioButton" />
    </UserControl.Resources>

    <Grid Background="{DynamicResource PanelBackgroundBrush}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- Header Area (File Selector & Toolbar) -->
        <Border Grid.Row="0"
                Padding="2,12,2,0"
                BorderBrush="{DynamicResource BorderBrush}"
                BorderThickness="0,0,0,1">
            <StackPanel>
                <!-- Controls Row -->
                <Grid Margin="10,0,10,10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <!-- File Selector -->
                    <ComboBox Grid.Column="0"
                              Margin="0,0,10,0"
                              HorizontalAlignment="Stretch"
                              VerticalAlignment="Center"
                              AutomationProperties.AutomationId="CssFileSelector"
                              ItemsSource="{Binding DataContext.AvailableCssFiles, RelativeSource={RelativeSource AncestorType=Window}}"
                              SelectedItem="{Binding DataContext.SelectedCssFile, RelativeSource={RelativeSource AncestorType=Window}}"
                              Style="{StaticResource CompactFormComboBoxStyle}"
                              ToolTip="スタイル選択" />

                    <!-- Action Buttons -->
                    <StackPanel Grid.Column="1"
                                VerticalAlignment="Center"
                                Orientation="Horizontal">
                        <Button Margin="0,0,5,0"
                                AutomationProperties.AutomationId="SaveCssButton"
                                Command="{Binding SaveCssCommand}"
                                Style="{StaticResource IconButtonStyle}"
                                ToolTip="CSSを保存">
                            <Path Width="14"
                                  Height="14"
                                  Data="{StaticResource SaveIconGeometry}"
                                  Fill="{DynamicResource SecondaryTextBrush}"
                                  Stretch="Uniform" />
                        </Button>
                        <Button AutomationProperties.AutomationId="ResetCssButton"
                                Command="{Binding ResetCommand}"
                                Style="{StaticResource IconButtonStyle}"
                                ToolTip="設定をリセット (ファイルから再読み込み)">
                            <Path Width="14"
                                  Height="14"
                                  Data="{StaticResource RefreshIconGeometry}"
                                  Fill="{DynamicResource SecondaryTextBrush}"
                                  Stretch="Uniform" />
                        </Button>
                    </StackPanel>
                </Grid>

                <!-- Horizontal Tabs -->
                <ScrollViewer Style="{StaticResource ScrollViewerWithButtonsStyle}">
                    <StackPanel Orientation="Horizontal">
                        <RadioButton behaviors:StyleBehavior.IsDirty="{Binding IsTitleTabDirty}"
                                     AutomationProperties.AutomationId="TitleTab"
                                     Content="タイトル"
                                     IsChecked="{Binding SelectedTab, Converter={StaticResource ComparisonConverter}, ConverterParameter={x:Static vm:CssEditorTab.Title}}"
                                     Tag="T"
                                     Visibility="{Binding IsTitleTabVisible, Converter={StaticResource BooleanToVisibilityConverter}}" />
                        <RadioButton behaviors:StyleBehavior.IsDirty="{Binding IsGeneralTabDirty}"
                                     AutomationProperties.AutomationId="GeneralTab"
                                     Content="全体"
                                     IsChecked="{Binding SelectedTab, Converter={StaticResource ComparisonConverter}, ConverterParameter={x:Static vm:CssEditorTab.General}}"
                                     Tag="🌐" />
                        <RadioButton behaviors:StyleBehavior.IsDirty="{Binding IsHeadingsTabDirty}"
                                     AutomationProperties.AutomationId="HeadingsTab"
                                     Content="見出し"
                                     IsChecked="{Binding SelectedTab, Converter={StaticResource ComparisonConverter}, ConverterParameter={x:Static vm:CssEditorTab.Headings}}"
                                     Tag="#" />
                        <RadioButton behaviors:StyleBehavior.IsDirty="{Binding IsListTabDirty}"
                                     AutomationProperties.AutomationId="ListTab"
                                     Content="リスト"
                                     IsChecked="{Binding SelectedTab, Converter={StaticResource ComparisonConverter}, ConverterParameter={x:Static vm:CssEditorTab.List}}"
                                     Tag="≡" />
                        <RadioButton behaviors:StyleBehavior.IsDirty="{Binding IsTableTabDirty}"
                                     AutomationProperties.AutomationId="TableTab"
                                     Content="表"
                                     IsChecked="{Binding SelectedTab, Converter={StaticResource ComparisonConverter}, ConverterParameter={x:Static vm:CssEditorTab.Table}}"
                                     Tag="▦" />
                        <RadioButton behaviors:StyleBehavior.IsDirty="{Binding IsCodeTabDirty}"
                                     AutomationProperties.AutomationId="CodeTab"
                                     Content="コード"
                                     IsChecked="{Binding SelectedTab, Converter={StaticResource ComparisonConverter}, ConverterParameter={x:Static vm:CssEditorTab.Code}}"
                                     Tag="&lt;&gt;" />
                        <RadioButton behaviors:StyleBehavior.IsDirty="{Binding IsQuoteTabDirty}"
                                     AutomationProperties.AutomationId="QuoteTab"
                                     Content="引用"
                                     IsChecked="{Binding SelectedTab, Converter={StaticResource ComparisonConverter}, ConverterParameter={x:Static vm:CssEditorTab.Quote}}"
                                     Tag="¶" />
                        <RadioButton behaviors:StyleBehavior.IsDirty="{Binding IsFootnoteTabDirty}"
                                     AutomationProperties.AutomationId="FootnoteTab"
                                     Content="注釈"
                                     IsChecked="{Binding SelectedTab, Converter={StaticResource ComparisonConverter}, ConverterParameter={x:Static vm:CssEditorTab.Footnote}}"
                                     Tag="†" />
                    </StackPanel>
                </ScrollViewer>
            </StackPanel>
        </Border>

        <!-- Content Area -->
        <ScrollViewer Grid.Row="1"
                      Padding="20"
                      VerticalScrollBarVisibility="Auto">
            <Grid>
                <!-- Title Tab -->
                <StackPanel Visibility="{Binding SelectedTab, Converter={StaticResource ComparisonConverter}, ConverterParameter={x:Static vm:CssEditorTab.Title}}">
                    <Label Content="文字スタイル" Style="{StaticResource FirstCompactFormGroupHeaderStyle}" />
                    <Label Content="サイズ" Style="{StaticResource CompactFormLabelStyle}" />
                    <controls:CssNumericEditorControl HorizontalAlignment="Left"
                                                      CssValue="{Binding TitleFontSize, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                      DefaultUnit="{Binding Defaults.Title.FontSizeUnit}"
                                                      DefaultValue="{Binding Defaults.Title.FontSize}" />

                    <Label Content="フォントファミリー" Style="{StaticResource CompactFormLabelStyle}" />
                    <TextBox Style="{StaticResource CompactFormTextBoxMediumStyle}" Text="{Binding TitleFontFamily, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />

                    <Label Content="スタイル" Style="{StaticResource CompactFormLabelStyle}" />
                    <StackPanel Margin="0,0,0,12" Orientation="Horizontal">
                        <CheckBox IsChecked="{Binding IsTitleBold, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource CompactFormCheckBoxStyle}">
                            <TextBlock FontWeight="Bold" Text="太字" />
                        </CheckBox>
                        <CheckBox IsChecked="{Binding IsTitleItalic, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource CompactFormCheckBoxStyle}">
                            <TextBlock FontStyle="Italic" Text="斜体" />
                        </CheckBox>
                        <CheckBox IsChecked="{Binding IsTitleUnderline, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource CompactFormCheckBoxStyle}">
                            <TextBlock Text="下線" TextDecorations="Underline" />
                        </CheckBox>
                    </StackPanel>

                    <Label Content="文字色" Style="{StaticResource CompactFormLabelStyle}" />
                    <controls:ColorInputControl ColorText="{Binding TitleTextColor, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                CommandParameter="TitleTextColor"
                                                SelectColorCommand="{Binding SelectColorCommand}" />

                    <Label Content="レイアウト・余白" Style="{StaticResource CompactFormGroupHeaderStyle}" />
                    <Label Content="位置揃え" Style="{StaticResource CompactFormLabelStyle}" />
                    <StackPanel Margin="0,0,0,12" Orientation="Horizontal">
                        <ToggleButton CommandParameter="left"
                                      IsChecked="{Binding TitleAlignment, Converter={StaticResource ComparisonConverter}, ConverterParameter=left}"
                                      Style="{StaticResource IconToggleButtonStyle}"
                                      ToolTip="左寄せ">
                            <Path Width="16"
                                  Height="16"
                                  Data="{StaticResource AlignLeftIconGeometry}"
                                  Stretch="Uniform" />
                        </ToggleButton>
                        <ToggleButton CommandParameter="center"
                                      IsChecked="{Binding TitleAlignment, Converter={StaticResource ComparisonConverter}, ConverterParameter=center}"
                                      Style="{StaticResource IconToggleButtonStyle}"
                                      ToolTip="中央寄せ">
                            <Path Width="16"
                                  Height="16"
                                  Data="{StaticResource AlignCenterIconGeometry}"
                                  Stretch="Uniform" />
                        </ToggleButton>
                        <ToggleButton CommandParameter="right"
                                      IsChecked="{Binding TitleAlignment, Converter={StaticResource ComparisonConverter}, ConverterParameter=right}"
                                      Style="{StaticResource IconToggleButtonStyle}"
                                      ToolTip="右寄せ">
                            <Path Width="16"
                                  Height="16"
                                  Data="{StaticResource AlignRightIconGeometry}"
                                  Stretch="Uniform" />
                        </ToggleButton>
                    </StackPanel>

                    <Label Content="下マージン" Style="{StaticResource CompactFormLabelStyle}" />
                    <controls:CssNumericEditorControl HorizontalAlignment="Left"
                                                      CssValue="{Binding TitleMarginBottom, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                      DefaultUnit="{Binding Defaults.Title.MarginBottomUnit}"
                                                      DefaultValue="{Binding Defaults.Title.MarginBottom}"
                                                      ShowSpinner="True" />
                </StackPanel>

                <!-- General Tab -->
                <StackPanel Visibility="{Binding SelectedTab, Converter={StaticResource ComparisonConverter}, ConverterParameter={x:Static vm:CssEditorTab.General}}">
                    <Label Content="文字スタイル" Style="{StaticResource FirstCompactFormGroupHeaderStyle}" />
                    <Label Content="フォントサイズ" Style="{StaticResource CompactFormLabelStyle}" />
                    <controls:CssNumericEditorControl HorizontalAlignment="Left"
                                                      AutomationProperties.AutomationId="BodyFontSizeEditor"
                                                      CssValue="{Binding BodyFontSize, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                      DefaultUnit="{Binding Defaults.General.FontSizeUnit}"
                                                      DefaultValue="{Binding Defaults.General.FontSize}" />

                    <Label Content="フォントファミリー" Style="{StaticResource CompactFormLabelStyle}" />
                    <TextBox Style="{StaticResource CompactFormTextBoxMediumStyle}" Text="{Binding BodyFontFamily, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />

                    <Label Content="文字色" Style="{StaticResource CompactFormLabelStyle}" />
                    <controls:ColorInputControl AutomationProperties.AutomationId="BodyTextColorEditor"
                                                ColorText="{Binding BodyTextColor, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                CommandParameter="BodyTextColor"
                                                SelectColorCommand="{Binding SelectColorCommand}" />

                    <Label Content="行間" Style="{StaticResource CompactFormLabelStyle}" />
                    <controls:CssNumericEditorControl HorizontalAlignment="Left"
                                                      CssValue="{Binding ParagraphLineHeight, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                      DefaultUnit="{Binding Defaults.General.LineHeightUnit}"
                                                      DefaultValue="{Binding Defaults.General.LineHeight}"
                                                      ShowSpinner="True" />

                    <Label Content="背景設定" Style="{StaticResource CompactFormGroupHeaderStyle}" />
                    <Label Content="背景色" Style="{StaticResource CompactFormLabelStyle}" />
                    <controls:ColorInputControl ColorText="{Binding BodyBackgroundColor, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                CommandParameter="BodyBackgroundColor"
                                                SelectColorCommand="{Binding SelectColorCommand}" />

                    <Label Content="レイアウト・余白" Style="{StaticResource CompactFormGroupHeaderStyle}" />
                    <Label Content="行頭インデント (字下げ)" Style="{StaticResource CompactFormLabelStyle}" />
                    <controls:CssNumericEditorControl HorizontalAlignment="Left"
                                                      CssValue="{Binding ParagraphTextIndent, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                      DefaultUnit="{Binding Defaults.General.TextIndentUnit}"
                                                      DefaultValue="{Binding Defaults.General.TextIndent}"
                                                      ShowSpinner="True" />

                    <Label Content="段落下の余白" Style="{StaticResource CompactFormLabelStyle}" />
                    <controls:CssNumericEditorControl HorizontalAlignment="Left"
                                                      CssValue="{Binding ParagraphMarginBottom, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                      DefaultUnit="{Binding Defaults.General.MarginBottomUnit}"
                                                      DefaultValue="{Binding Defaults.General.MarginBottom}"
                                                      ShowSpinner="True" />
                </StackPanel>

                <!-- Headings Tab -->
                <StackPanel Visibility="{Binding SelectedTab, Converter={StaticResource ComparisonConverter}, ConverterParameter={x:Static vm:CssEditorTab.Headings}}">
                    <Label Content="対象設定" Style="{StaticResource FirstCompactFormGroupHeaderStyle}" />
                    <Label Content="対象見出し" Style="{StaticResource CompactFormLabelStyle}" />
                    <ComboBox ItemsSource="{Binding AvailableHeadingLevels}"
                              SelectedItem="{Binding SelectedHeadingLevel, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                              Style="{StaticResource CompactFormComboBoxWideStyle}" />

                    <Label Content="文字スタイル" Style="{StaticResource CompactFormGroupHeaderStyle}" />
                    <Label Content="サイズ" Style="{StaticResource CompactFormLabelStyle}" />
                    <controls:CssNumericEditorControl HorizontalAlignment="Left"
                                                      CssValue="{Binding HeadingFontSize, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                      DefaultUnit="{Binding Defaults.Headings.FontSizeUnit}"
                                                      DefaultValue="{Binding Defaults.Headings.FontSize}" />

                    <Label Content="フォントファミリー" Style="{StaticResource CompactFormLabelStyle}" />
                    <TextBox Style="{StaticResource CompactFormTextBoxMediumStyle}" Text="{Binding HeadingFontFamily, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />

                    <Label Content="スタイル" Style="{StaticResource CompactFormLabelStyle}" />
                    <StackPanel Margin="0,0,0,12" Orientation="Horizontal">
                        <CheckBox IsChecked="{Binding IsHeadingBold, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource CompactFormCheckBoxStyle}">
                            <TextBlock FontWeight="Bold" Text="太字" />
                        </CheckBox>
                        <CheckBox IsChecked="{Binding IsHeadingItalic, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource CompactFormCheckBoxStyle}">
                            <TextBlock FontStyle="Italic" Text="斜体" />
                        </CheckBox>
                        <CheckBox IsChecked="{Binding IsHeadingUnderline, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource CompactFormCheckBoxStyle}">
                            <TextBlock Text="下線" TextDecorations="Underline" />
                        </CheckBox>
                    </StackPanel>

                    <Label Content="文字色" Style="{StaticResource CompactFormLabelStyle}" />
                    <controls:ColorInputControl ColorText="{Binding HeadingTextColor, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                CommandParameter="HeadingTextColor"
                                                SelectColorCommand="{Binding SelectColorCommand}" />

                    <Label Content="レイアウト・余白" Style="{StaticResource CompactFormGroupHeaderStyle}" />
                    <Label Content="位置揃え" Style="{StaticResource CompactFormLabelStyle}" />
                    <StackPanel Margin="0,0,0,12" Orientation="Horizontal">
                        <ToggleButton CommandParameter="left"
                                      IsChecked="{Binding HeadingAlignment, Converter={StaticResource ComparisonConverter}, ConverterParameter=left}"
                                      Style="{StaticResource IconToggleButtonStyle}"
                                      ToolTip="左寄せ">
                            <Path Width="16"
                                  Height="16"
                                  Data="{StaticResource AlignLeftIconGeometry}"
                                  Stretch="Uniform" />
                        </ToggleButton>
                        <ToggleButton CommandParameter="center"
                                      IsChecked="{Binding HeadingAlignment, Converter={StaticResource ComparisonConverter}, ConverterParameter=center}"
                                      Style="{StaticResource IconToggleButtonStyle}"
                                      ToolTip="中央寄せ">
                            <Path Width="16"
                                  Height="16"
                                  Data="{StaticResource AlignCenterIconGeometry}"
                                  Stretch="Uniform" />
                        </ToggleButton>
                        <ToggleButton CommandParameter="right"
                                      IsChecked="{Binding HeadingAlignment, Converter={StaticResource ComparisonConverter}, ConverterParameter=right}"
                                      Style="{StaticResource IconToggleButtonStyle}"
                                      ToolTip="右寄せ">
                            <Path Width="16"
                                  Height="16"
                                  Data="{StaticResource AlignRightIconGeometry}"
                                  Stretch="Uniform" />
                        </ToggleButton>
                    </StackPanel>

                    <Label Content="上マージン" Style="{StaticResource CompactFormLabelStyle}" />
                    <controls:CssNumericEditorControl HorizontalAlignment="Left"
                                                      CssValue="{Binding HeadingMarginTop, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                      DefaultUnit="{Binding Defaults.Headings.MarginTopUnit}"
                                                      DefaultValue="{Binding Defaults.Headings.MarginTop}"
                                                      ShowSpinner="True" />

                    <Label Content="下マージン" Style="{StaticResource CompactFormLabelStyle}" />
                    <controls:CssNumericEditorControl HorizontalAlignment="Left"
                                                      CssValue="{Binding HeadingMarginBottom, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                      DefaultUnit="{Binding Defaults.Headings.MarginBottomUnit}"
                                                      DefaultValue="{Binding Defaults.Headings.MarginBottom}"
                                                      ShowSpinner="True" />

                    <Label Content="補助機能" Style="{StaticResource CompactFormGroupHeaderStyle}" />
                    <CheckBox Content="項番の自動採番"
                              IsChecked="{Binding IsHeadingNumberingEnabled, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                              Style="{StaticResource CompactFormCheckBoxStyle}" />
                </StackPanel>

                <!-- List Tab -->
                <StackPanel Visibility="{Binding SelectedTab, Converter={StaticResource ComparisonConverter}, ConverterParameter={x:Static vm:CssEditorTab.List}}">
                    <Label Content="マーカー設定" Style="{StaticResource FirstCompactFormGroupHeaderStyle}" />
                    <Label Content="箇条書き (ul)" Style="{StaticResource CompactFormLabelStyle}" />
                    <ListBox Margin="0,0,0,8"
                             Background="{DynamicResource WindowBackgroundBrush}"
                             BorderBrush="{DynamicResource BorderBrush}"
                             ItemContainerStyle="{StaticResource ListMarkerListBoxItemStyle}"
                             ItemTemplate="{StaticResource ListMarkerItemTemplate}"
                             ItemsSource="{Binding AvailableListMarkerTypes}"
                             SelectedItem="{Binding ListMarkerType, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                        <ListBox.ItemsPanel>
                            <ItemsPanelTemplate>
                                <UniformGrid Columns="4" />
                            </ItemsPanelTemplate>
                        </ListBox.ItemsPanel>
                    </ListBox>

                    <Label Content="番号付き (ol)" Style="{StaticResource CompactFormLabelStyle}" />
                    <ListBox Margin="0,0,0,8"
                             Background="{DynamicResource WindowBackgroundBrush}"
                             BorderBrush="{DynamicResource BorderBrush}"
                             ItemContainerStyle="{StaticResource ListMarkerListBoxItemStyle}"
                             ItemTemplate="{StaticResource ListMarkerItemTemplate}"
                             ItemsSource="{Binding AvailableNumberedListMarkerTypes}"
                             SelectedItem="{Binding NumberedListMarkerType, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                        <ListBox.ItemsPanel>
                            <ItemsPanelTemplate>
                                <UniformGrid Columns="4" />
                            </ItemsPanelTemplate>
                        </ListBox.ItemsPanel>
                    </ListBox>

                    <CheckBox Margin="0,0,0,12"
                              Content="番号の後にピリオドを表示する"
                              IsChecked="{Binding NumberedListHasPeriod, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                              Style="{StaticResource CompactFormCheckBoxStyle}" />

                    <Label Content="文字スタイル" Style="{StaticResource CompactFormGroupHeaderStyle}" />
                    <Label Content="フォントサイズ" Style="{StaticResource CompactFormLabelStyle}" />
                    <controls:CssNumericEditorControl HorizontalAlignment="Left"
                                                      CssValue="{Binding ListMarkerSize, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                      DefaultUnit="{Binding Defaults.List.MarkerSizeUnit}"
                                                      DefaultValue="{Binding Defaults.List.MarkerSize}" />

                    <Label Content="行間" Style="{StaticResource CompactFormLabelStyle}" />
                    <controls:CssNumericEditorControl HorizontalAlignment="Left"
                                                      CssValue="{Binding ListLineHeight, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                      DefaultUnit="{Binding Defaults.List.LineHeightUnit}"
                                                      DefaultValue="{Binding Defaults.List.LineHeight}"
                                                      ShowSpinner="True" />

                    <Label Content="レイアウト・余白" Style="{StaticResource CompactFormGroupHeaderStyle}" />
                    <Label Content="インデント" Style="{StaticResource CompactFormLabelStyle}" />
                    <controls:CssNumericEditorControl HorizontalAlignment="Left"
                                                      CssValue="{Binding ListIndent, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                      DefaultUnit="{Binding Defaults.List.IndentUnit}"
                                                      DefaultValue="{Binding Defaults.List.Indent}"
                                                      ShowSpinner="True" />
                </StackPanel>

                <!-- Table Tab -->
                <StackPanel Visibility="{Binding SelectedTab, Converter={StaticResource ComparisonConverter}, ConverterParameter={x:Static vm:CssEditorTab.Table}}">
                    <Label Content="レイアウト設定" Style="{StaticResource FirstCompactFormGroupHeaderStyle}" />
                    <Label Content="表の幅" Style="{StaticResource CompactFormLabelStyle}" />
                    <controls:CssNumericEditorControl HorizontalAlignment="Left"
                                                      CssValue="{Binding TableWidth, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                      DefaultUnit="{Binding Defaults.Table.WidthUnit}"
                                                      DefaultValue="{Binding Defaults.Table.Width}"
                                                      ShowSpinner="True" />

                    <Label Content="罫線設定" Style="{StaticResource CompactFormGroupHeaderStyle}" />
                    <Label Content="太さ" Style="{StaticResource CompactFormLabelStyle}" />
                    <controls:CssNumericEditorControl HorizontalAlignment="Left"
                                                      CssValue="{Binding TableBorderWidth, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                      DefaultValue="{Binding Defaults.Table.BorderWidth}"
                                                      FixedUnit="{Binding Defaults.Table.BorderWidthUnit}"
                                                      IsUnitFixed="True"
                                                      ShowSpinner="True" />

                    <Label Content="種類" Style="{StaticResource CompactFormLabelStyle}" />
                    <StackPanel Margin="0,0,0,12" Orientation="Horizontal">
                        <ToggleButton CommandParameter="solid"
                                      IsChecked="{Binding TableBorderStyle, Converter={StaticResource ComparisonConverter}, ConverterParameter=solid}"
                                      Style="{StaticResource IconToggleButtonStyle}"
                                      ToolTip="実線 (solid)">
                            <Path Width="16"
                                  Height="16"
                                  Data="{StaticResource BorderSolidIconGeometry}"
                                  Stretch="Uniform" />
                        </ToggleButton>
                        <ToggleButton CommandParameter="dotted"
                                      IsChecked="{Binding TableBorderStyle, Converter={StaticResource ComparisonConverter}, ConverterParameter=dotted}"
                                      Style="{StaticResource IconToggleButtonStyle}"
                                      ToolTip="点線 (dotted)">
                            <Path Width="16"
                                  Height="16"
                                  Data="{StaticResource BorderDottedIconGeometry}"
                                  Stretch="Uniform" />
                        </ToggleButton>
                        <ToggleButton CommandParameter="dashed"
                                      IsChecked="{Binding TableBorderStyle, Converter={StaticResource ComparisonConverter}, ConverterParameter=dashed}"
                                      Style="{StaticResource IconToggleButtonStyle}"
                                      ToolTip="破線 (dashed)">
                            <Path Width="16"
                                  Height="16"
                                  Data="{StaticResource BorderDashedIconGeometry}"
                                  Stretch="Uniform" />
                        </ToggleButton>
                    </StackPanel>

                    <Label Content="色" Style="{StaticResource CompactFormLabelStyle}" />
                    <controls:ColorInputControl ColorText="{Binding TableBorderColor, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                CommandParameter="TableBorderColor"
                                                SelectColorCommand="{Binding SelectColorCommand}" />

                    <Label Content="ヘッダー設定" Style="{StaticResource CompactFormGroupHeaderStyle}" />
                    <Label Content="背景色" Style="{StaticResource CompactFormLabelStyle}" />
                    <controls:ColorInputControl ColorText="{Binding TableHeaderBackgroundColor, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                CommandParameter="TableHeaderBackgroundColor"
                                                SelectColorCommand="{Binding SelectColorCommand}" />

                    <Label Content="文字色" Style="{StaticResource CompactFormLabelStyle}" />
                    <controls:ColorInputControl ColorText="{Binding TableHeaderTextColor, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                CommandParameter="TableHeaderTextColor"
                                                SelectColorCommand="{Binding SelectColorCommand}" />

                    <Label Content="フォントサイズ" Style="{StaticResource CompactFormLabelStyle}" />
                    <controls:CssNumericEditorControl HorizontalAlignment="Left"
                                                      CssValue="{Binding TableHeaderFontSize, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                      DefaultUnit="{Binding Defaults.Table.FontSizeUnit}"
                                                      DefaultValue="{Binding Defaults.Table.FontSize}" />

                    <Label Content="位置揃え" Style="{StaticResource CompactFormLabelStyle}" />
                    <StackPanel Orientation="Horizontal">
                        <ToggleButton CommandParameter="left"
                                      IsChecked="{Binding TableHeaderAlignment, Converter={StaticResource ComparisonConverter}, ConverterParameter=left}"
                                      Style="{StaticResource IconToggleButtonStyle}"
                                      ToolTip="左寄せ">
                            <Path Width="16"
                                  Height="16"
                                  Data="{StaticResource AlignLeftIconGeometry}"
                                  Stretch="Uniform" />
                        </ToggleButton>
                        <ToggleButton CommandParameter="center"
                                      IsChecked="{Binding TableHeaderAlignment, Converter={StaticResource ComparisonConverter}, ConverterParameter=center}"
                                      Style="{StaticResource IconToggleButtonStyle}"
                                      ToolTip="中央寄せ">
                            <Path Width="16"
                                  Height="16"
                                  Data="{StaticResource AlignCenterIconGeometry}"
                                  Stretch="Uniform" />
                        </ToggleButton>
                        <ToggleButton CommandParameter="right"
                                      IsChecked="{Binding TableHeaderAlignment, Converter={StaticResource ComparisonConverter}, ConverterParameter=right}"
                                      Style="{StaticResource IconToggleButtonStyle}"
                                      ToolTip="右寄せ">
                            <Path Width="16"
                                  Height="16"
                                  Data="{StaticResource AlignRightIconGeometry}"
                                  Stretch="Uniform" />
                        </ToggleButton>
                    </StackPanel>

                    <Label Content="セル設定" Style="{StaticResource CompactFormGroupHeaderStyle}" />
                    <Label Content="内側の余白 (パディング)" Style="{StaticResource CompactFormLabelStyle}" />
                    <controls:CssNumericEditorControl HorizontalAlignment="Left"
                                                      CssValue="{Binding TableCellPadding, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                      DefaultValue="{Binding Defaults.Table.CellPadding}"
                                                      FixedUnit="{Binding Defaults.Table.CellPaddingUnit}"
                                                      IsUnitFixed="True"
                                                      ShowSpinner="True" />
                </StackPanel>

                <!-- Code Tab -->
                <StackPanel Visibility="{Binding SelectedTab, Converter={StaticResource ComparisonConverter}, ConverterParameter={x:Static vm:CssEditorTab.Code}}">
                    <Label Content="共通設定" Style="{StaticResource FirstCompactFormGroupHeaderStyle}" />
                    <Label Content="フォントファミリー" Style="{StaticResource CompactFormLabelStyle}" />
                    <TextBox Style="{StaticResource CompactFormTextBoxMediumStyle}" Text="{Binding CodeFontFamily, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />

                    <Label Content="インラインコード" Style="{StaticResource CompactFormGroupHeaderStyle}" />
                    <Label Content="文字色" Style="{StaticResource CompactFormLabelStyle}" />
                    <controls:ColorInputControl ColorText="{Binding InlineCodeTextColor, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                CommandParameter="InlineCodeTextColor"
                                                SelectColorCommand="{Binding SelectColorCommand}" />

                    <Label Content="背景色" Style="{StaticResource CompactFormLabelStyle}" />
                    <controls:ColorInputControl ColorText="{Binding InlineCodeBackgroundColor, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                CommandParameter="InlineCodeBackgroundColor"
                                                SelectColorCommand="{Binding SelectColorCommand}" />

                    <Label Content="コードブロック" Style="{StaticResource CompactFormGroupHeaderStyle}" />
                    <!-- Code Block Override Warning -->
                    <TextBlock FontSize="11"
                               Foreground="Gray"
                               TextWrapping="Wrap"
                               Visibility="{Binding IsCodeBlockOverrideEnabled, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=Inverse}">
                        <Run Text="※設定画面で「テーマに従う」が選択されているため、ここでは設定できません。" />
                    </TextBlock>

                    <StackPanel Visibility="{Binding IsCodeBlockOverrideEnabled, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <Label Content="文字色" Style="{StaticResource CompactFormLabelStyle}" />
                        <controls:ColorInputControl ColorText="{Binding BlockCodeTextColor, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                    CommandParameter="BlockCodeTextColor"
                                                    SelectColorCommand="{Binding SelectColorCommand}" />

                        <Label Content="背景色" Style="{StaticResource CompactFormLabelStyle}" />
                        <controls:ColorInputControl ColorText="{Binding BlockCodeBackgroundColor, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                    CommandParameter="BlockCodeBackgroundColor"
                                                    SelectColorCommand="{Binding SelectColorCommand}" />
                        <TextBlock Margin="0,4,0,0"
                                   FontSize="11"
                                   Foreground="Gray"
                                   Text="※設定画面で「テーマを上書きする」が有効です。!important を付与して強制適用します。"
                                   TextWrapping="Wrap" />
                    </StackPanel>
                </StackPanel>

                <!-- Quote Tab (Blockquote) -->
                <StackPanel Visibility="{Binding SelectedTab, Converter={StaticResource ComparisonConverter}, ConverterParameter={x:Static vm:CssEditorTab.Quote}}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <Label Content="デザインプリセット" Style="{StaticResource FirstCompactFormGroupHeaderStyle}" />
                        <Button Grid.Column="1"
                                Margin="0,0,10,0"
                                VerticalAlignment="Center"
                                Command="{Binding ClearQuoteStyleCommand}"
                                Style="{StaticResource IconButtonStyle}"
                                ToolTip="選択を解除">
                            <Path Width="10"
                                  Height="10"
                                  Data="M0,0 L10,10 M10,0 L0,10"
                                  Stroke="{DynamicResource SecondaryTextBrush}"
                                  StrokeThickness="1.5" />
                        </Button>
                    </Grid>
                    <ListBox Margin="0,0,0,12"
                             Background="{DynamicResource WindowBackgroundBrush}"
                             BorderBrush="{DynamicResource BorderBrush}"
                             ItemContainerStyle="{StaticResource ListMarkerListBoxItemStyle}"
                             ItemsSource="{Binding AvailableQuoteStyles}"
                             SelectedItem="{Binding QuoteStyle, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                        <ListBox.ItemsPanel>
                            <ItemsPanelTemplate>
                                <UniformGrid Columns="2" />
                            </ItemsPanelTemplate>
                        </ListBox.ItemsPanel>
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <TextBlock x:Name="PresetText"
                                           Foreground="{DynamicResource PrimaryTextBrush}"
                                           Text="{Binding}"
                                           TextAlignment="Center" />
                                <DataTemplate.Triggers>
                                    <DataTrigger Binding="{Binding}" Value="simple">
                                        <Setter TargetName="PresetText" Property="Text" Value="標準 (Simple)" />
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding}" Value="card">
                                        <Setter TargetName="PresetText" Property="Text" Value="カード (Card)" />
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding}" Value="topbottom">
                                        <Setter TargetName="PresetText" Property="Text" Value="上下線 (Line)" />
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding}" Value="modern">
                                        <Setter TargetName="PresetText" Property="Text" Value="モダン (Modern)" />
                                    </DataTrigger>
                                </DataTemplate.Triggers>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>

                    <CheckBox Margin="0,4,0,12"
                              Content="引用符アイコン (“) を表示"
                              IsChecked="{Binding QuoteShowIcon, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                              Style="{StaticResource CompactFormCheckBoxStyle}" />

                    <Label Content="プリセットの上書き (CSS保存)" Style="{StaticResource CompactFormGroupHeaderStyle}" />
                    <Label Content="文字色" Style="{StaticResource CompactFormLabelStyle}" />
                    <controls:ColorInputControl ColorText="{Binding QuoteTextColor, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                CommandParameter="QuoteTextColor"
                                                SelectColorCommand="{Binding SelectColorCommand}" />

                    <CheckBox Margin="0,4,0,12"
                              Content="斜体にする"
                              IsChecked="{Binding QuoteIsItalic, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                              Style="{StaticResource CompactFormCheckBoxStyle}" />

                    <Label Content="背景色" Style="{StaticResource CompactFormLabelStyle}" />
                    <controls:ColorInputControl ColorText="{Binding QuoteBackgroundColor, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                CommandParameter="QuoteBackgroundColor"
                                                SelectColorCommand="{Binding SelectColorCommand}" />

                    <Label Content="枠線の色" Style="{StaticResource CompactFormLabelStyle}" />
                    <controls:ColorInputControl ColorText="{Binding QuoteBorderColor, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                CommandParameter="QuoteBorderColor"
                                                SelectColorCommand="{Binding SelectColorCommand}" />

                    <Label Content="角丸" Style="{StaticResource CompactFormLabelStyle}" />
                    <controls:CssNumericEditorControl HorizontalAlignment="Left"
                                                      CssValue="{Binding QuoteBorderRadius, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                      DefaultValue="{Binding Defaults.Quote.BorderRadius}"
                                                      FixedUnit="{Binding Defaults.Quote.BorderRadiusUnit}"
                                                      IsUnitFixed="True"
                                                      ShowSpinner="True" />

                    <Label Content="内側の余白 (パディング)" Style="{StaticResource CompactFormLabelStyle}" />
                    <controls:CssNumericEditorControl HorizontalAlignment="Left"
                                                      CssValue="{Binding QuotePadding, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                      DefaultUnit="{Binding Defaults.Quote.PaddingUnit}"
                                                      DefaultValue="{Binding Defaults.Quote.Padding}"
                                                      ShowSpinner="True" />
                </StackPanel>

                <!-- Footnote Tab -->
                <StackPanel Visibility="{Binding SelectedTab, Converter={StaticResource ComparisonConverter}, ConverterParameter={x:Static vm:CssEditorTab.Footnote}}">
                    <Label Content="本文中マーカー" Style="{StaticResource FirstCompactFormGroupHeaderStyle}" />
                    <Label Content="文字色" Style="{StaticResource CompactFormLabelStyle}" />
                    <controls:ColorInputControl ColorText="{Binding FootnoteMarkerTextColor, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                CommandParameter="FootnoteMarkerTextColor"
                                                SelectColorCommand="{Binding SelectColorCommand}" />

                    <Label Content="スタイル" Style="{StaticResource CompactFormLabelStyle}" />
                    <StackPanel Margin="0,0,0,12" Orientation="Horizontal">
                        <CheckBox IsChecked="{Binding IsFootnoteMarkerBold, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource CompactFormCheckBoxStyle}">
                            <TextBlock FontWeight="Bold" Text="太字" />
                        </CheckBox>
                        <CheckBox Content="括弧で囲む [1]"
                                  IsChecked="{Binding HasFootnoteMarkerBrackets, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                  Style="{StaticResource CompactFormCheckBoxStyle}" />
                    </StackPanel>

                    <Label Content="エリア基本設定" Style="{StaticResource CompactFormGroupHeaderStyle}" />
                    <Label Content="フォントサイズ" Style="{StaticResource CompactFormLabelStyle}" />
                    <controls:CssNumericEditorControl HorizontalAlignment="Left"
                                                      CssValue="{Binding FootnoteAreaFontSize, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                      DefaultUnit="{Binding Defaults.Footnote.FontSizeUnit}"
                                                      DefaultValue="{Binding Defaults.Footnote.FontSize}" />

                    <Label Content="文字色" Style="{StaticResource CompactFormLabelStyle}" />
                    <controls:ColorInputControl ColorText="{Binding FootnoteAreaTextColor, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                CommandParameter="FootnoteAreaTextColor"
                                                SelectColorCommand="{Binding SelectColorCommand}" />

                    <Label Content="上マージン" Style="{StaticResource CompactFormLabelStyle}" />
                    <controls:CssNumericEditorControl HorizontalAlignment="Left"
                                                      CssValue="{Binding FootnoteAreaMarginTop, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                      DefaultUnit="{Binding Defaults.Footnote.MarginTopUnit}"
                                                      DefaultValue="{Binding Defaults.Footnote.MarginTop}"
                                                      ShowSpinner="True" />

                    <Label Content="区切り線 (hr)" Style="{StaticResource CompactFormGroupHeaderStyle}" />
                    <Label Content="太さ" Style="{StaticResource CompactFormLabelStyle}" />
                    <controls:CssNumericEditorControl HorizontalAlignment="Left"
                                                      CssValue="{Binding FootnoteAreaBorderTopWidth, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                      DefaultValue="{Binding Defaults.Footnote.BorderWidth}"
                                                      FixedUnit="{Binding Defaults.Footnote.BorderWidthUnit}"
                                                      IsUnitFixed="True"
                                                      ShowSpinner="True" />

                    <Label Content="色" Style="{StaticResource CompactFormLabelStyle}" />
                    <controls:ColorInputControl ColorText="{Binding FootnoteAreaBorderTopColor, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                CommandParameter="FootnoteAreaBorderTopColor"
                                                SelectColorCommand="{Binding SelectColorCommand}" />

                    <Label Content="種類" Style="{StaticResource CompactFormLabelStyle}" />
                    <StackPanel Margin="0,0,0,12" Orientation="Horizontal">
                        <ToggleButton CommandParameter="solid"
                                      IsChecked="{Binding FootnoteAreaBorderTopStyle, Converter={StaticResource ComparisonConverter}, ConverterParameter=solid}"
                                      Style="{StaticResource IconToggleButtonStyle}"
                                      ToolTip="実線 (solid)">
                            <Path Width="16"
                                  Height="16"
                                  Data="{StaticResource BorderSolidIconGeometry}"
                                  Stretch="Uniform" />
                        </ToggleButton>
                        <ToggleButton CommandParameter="dotted"
                                      IsChecked="{Binding FootnoteAreaBorderTopStyle, Converter={StaticResource ComparisonConverter}, ConverterParameter=dotted}"
                                      Style="{StaticResource IconToggleButtonStyle}"
                                      ToolTip="点線 (dotted)">
                            <Path Width="16"
                                  Height="16"
                                  Data="{StaticResource BorderDottedIconGeometry}"
                                  Stretch="Uniform" />
                        </ToggleButton>
                    </StackPanel>

                    <Label Content="注釈リスト設定" Style="{StaticResource CompactFormGroupHeaderStyle}" />
                    <Label Content="行間" Style="{StaticResource CompactFormLabelStyle}" />
                    <controls:CssNumericEditorControl HorizontalAlignment="Left"
                                                      CssValue="{Binding FootnoteListItemLineHeight, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                      DefaultUnit="{Binding Defaults.Footnote.LineHeightUnit}"
                                                      DefaultValue="{Binding Defaults.Footnote.LineHeight}"
                                                      ShowSpinner="True" />

                    <CheckBox Margin="0,12,0,0"
                              Content="戻るリンク (↩) を表示"
                              IsChecked="{Binding IsFootnoteBackLinkVisible, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                              Style="{StaticResource CompactFormCheckBoxStyle}" />
                </StackPanel>
            </Grid>
        </ScrollViewer>
    </Grid>
</UserControl>
