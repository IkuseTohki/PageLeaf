<Window x:Class="PageLeaf.Views.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:behaviors="clr-namespace:PageLeaf.Behaviors"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:models="clr-namespace:PageLeaf.Models"
        xmlns:vm="clr-namespace:PageLeaf.ViewModels"
        Title="è¨­å®š"
        Width="680"
        Height="500"
        behaviors:FocusTrapBehavior.IsEnabled="True"
        behaviors:WindowAnimationBehavior.AnimationType="Modal"
        behaviors:WindowDragBehavior.IsEnabled="True"
        AllowsTransparency="True"
        Background="Transparent"
        ResizeMode="NoResize"
        WindowStartupLocation="CenterOwner"
        WindowStyle="None"
        mc:Ignorable="d">
    <Border KeyboardNavigation.TabNavigation="Cycle" Style="{StaticResource SettingsWindowBorderStyle}">
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="200" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <!-- Sidebar Navigation -->
            <Border Grid.Row="0"
                    Grid.RowSpan="2"
                    Grid.Column="0"
                    Style="{StaticResource SidebarPanelBorderStyle}">
                <StackPanel Margin="10,20">
                    <TextBlock Style="{StaticResource SettingsTitleTextStyle}" Text="è¨­å®š" />

                    <RadioButton Content="å¤–è¦³"
                                 IsChecked="{Binding CurrentCategory, Converter={StaticResource ComparisonConverter}, ConverterParameter={x:Static vm:SettingsCategory.Appearance}}"
                                 Style="{StaticResource SidebarMenuItemStyle}"
                                 Tag="ðŸŽ¨" />
                    <RadioButton Content="ã‚¨ãƒ‡ã‚£ã‚¿"
                                 IsChecked="{Binding CurrentCategory, Converter={StaticResource ComparisonConverter}, ConverterParameter={x:Static vm:SettingsCategory.Editor}}"
                                 Style="{StaticResource SidebarMenuItemStyle}"
                                 Tag="ðŸ–Šï¸" />
                    <RadioButton Content="ç”»åƒãƒ»ãƒ•ã‚¡ã‚¤ãƒ«"
                                 IsChecked="{Binding CurrentCategory, Converter={StaticResource ComparisonConverter}, ConverterParameter={x:Static vm:SettingsCategory.Image}}"
                                 Style="{StaticResource SidebarMenuItemStyle}"
                                 Tag="ðŸ–¼ï¸" />
                    <RadioButton Content="è¡¨ç¤º (ã‚³ãƒ¼ãƒ‰)"
                                 IsChecked="{Binding CurrentCategory, Converter={StaticResource ComparisonConverter}, ConverterParameter={x:Static vm:SettingsCategory.Code}}"
                                 Style="{StaticResource SidebarMenuItemStyle}"
                                 Tag="ðŸ§©" />
                    <RadioButton Content="è¨ºæ–­ãƒ»ãƒ­ã‚°"
                                 IsChecked="{Binding CurrentCategory, Converter={StaticResource ComparisonConverter}, ConverterParameter={x:Static vm:SettingsCategory.Diagnostic}}"
                                 Style="{StaticResource SidebarMenuItemStyle}"
                                 Tag="ðŸ› ï¸" />
                </StackPanel>
            </Border>

            <!-- Content Area -->
            <ScrollViewer Grid.Row="0"
                          Grid.Column="1"
                          Margin="25,25,25,10"
                          VerticalScrollBarVisibility="Auto">
                <Grid>
                    <!-- Appearance Settings -->
                    <StackPanel Visibility="{Binding CurrentCategory, Converter={StaticResource ComparisonConverter}, ConverterParameter={x:Static vm:SettingsCategory.Appearance}}">
                        <Label Content="å¤–è¦³è¨­å®š" Style="{StaticResource FirstSectionHeaderLabelStyle}" />

                        <Label Content="ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ†ãƒ¼ãƒž" Style="{StaticResource FormLabelStyle}" />
                        <StackPanel Margin="0,0,0,20" Orientation="Horizontal">
                            <RadioButton Width="80"
                                         Height="28"
                                         Content="ã‚·ã‚¹ãƒ†ãƒ "
                                         IsChecked="{Binding Theme, Converter={StaticResource ComparisonConverter}, ConverterParameter={x:Static models:AppTheme.System}}"
                                         Style="{StaticResource SegmentedButtonStyle}" />
                            <RadioButton Width="80"
                                         Height="28"
                                         Margin="10,0,0,0"
                                         Content="ãƒ©ã‚¤ãƒˆ"
                                         IsChecked="{Binding Theme, Converter={StaticResource ComparisonConverter}, ConverterParameter={x:Static models:AppTheme.Light}}"
                                         Style="{StaticResource SegmentedButtonStyle}" />
                            <RadioButton Width="80"
                                         Height="28"
                                         Margin="10,0,0,0"
                                         Content="ãƒ€ãƒ¼ã‚¯"
                                         IsChecked="{Binding Theme, Converter={StaticResource ComparisonConverter}, ConverterParameter={x:Static models:AppTheme.Dark}}"
                                         Style="{StaticResource SegmentedButtonStyle}" />
                        </StackPanel>
                        <TextBlock Style="{StaticResource AnnotationTextStyle}" Text="â€»ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å…¨ä½“ã®é…è‰²ãƒ¢ãƒ¼ãƒ‰ã‚’é¸æŠžã—ã¾ã™ã€‚" />
                    </StackPanel>

                    <!-- Editor Settings -->
                    <StackPanel Visibility="{Binding CurrentCategory, Converter={StaticResource ComparisonConverter}, ConverterParameter={x:Static vm:SettingsCategory.Editor}}">
                        <Label Content="ã‚¨ãƒ‡ã‚£ã‚¿è¨­å®š" Style="{StaticResource FirstSectionHeaderLabelStyle}" />

                        <Label Content="ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚º" Style="{StaticResource FormLabelStyle}" />
                        <TextBox Style="{StaticResource FormTextBoxSmallStyle}" Text="{Binding EditorFontSize}" />
                        <TextBlock Style="{StaticResource AnnotationTextStyle}" Text="â€»ã‚¨ãƒ‡ã‚£ã‚¿ã®ãƒ†ã‚­ã‚¹ãƒˆã‚µã‚¤ã‚ºã‚’æŒ‡å®šã—ã¾ã™ï¼ˆpxï¼‰ã€‚" />

                        <CheckBox Content="ã‚¿ãƒ–ã®ä»£ã‚ã‚Šã«ã‚¹ãƒšãƒ¼ã‚¹ã‚’ä½¿ç”¨ã™ã‚‹"
                                  IsChecked="{Binding UseSpacesForIndent}"
                                  Style="{StaticResource FormCheckBoxStyle}" />

                        <Label Content="ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆå¹… (ã‚¹ãƒšãƒ¼ã‚¹æ•°)"
                               IsEnabled="{Binding UseSpacesForIndent}"
                               Style="{StaticResource FormLabelStyle}" />
                        <TextBox IsEnabled="{Binding UseSpacesForIndent}"
                                 Style="{StaticResource FormTextBoxSmallStyle}"
                                 Text="{Binding IndentSize}" />
                        <TextBlock Style="{StaticResource AnnotationTextStyle}" Text="â€»Tabã‚­ãƒ¼ã‚’æŠ¼ã—ãŸéš›ã«å…¥åŠ›ã•ã‚Œã‚‹ç©ºç™½ã®é‡ã‚’æŒ‡å®šã—ã¾ã™ã€‚" />

                        <Label Content="è„šæ³¨è¨­å®š" Style="{StaticResource SectionHeaderLabelStyle}" />
                        <CheckBox Content="ä¿å­˜æ™‚ã«è„šæ³¨ç•ªå·ã‚’ç™»å ´é †ã«æŒ¯ã‚Šç›´ã™"
                                  IsChecked="{Binding RenumberFootnotesOnSave}"
                                  Style="{StaticResource FormCheckBoxStyle}" />

                        <Label Content="ãƒ•ãƒ­ãƒ³ãƒˆãƒžã‚¿ãƒ¼è¨­å®š" Style="{StaticResource SectionHeaderLabelStyle}" />
                        <CheckBox Content="ãƒ•ãƒ­ãƒ³ãƒˆãƒžã‚¿ãƒ¼ã®ã‚¿ã‚¤ãƒˆãƒ«ã‚’ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã«è¡¨ç¤ºã™ã‚‹"
                                  IsChecked="{Binding ShowTitleInPreview}"
                                  Style="{StaticResource FormCheckBoxStyle}" />
                        <CheckBox Content="æ–°è¦ä½œæˆæ™‚ã«ãƒ•ãƒ­ãƒ³ãƒˆãƒžã‚¿ãƒ¼ã‚’è‡ªå‹•æŒ¿å…¥ã™ã‚‹"
                                  IsChecked="{Binding AutoInsertFrontMatter}"
                                  Style="{StaticResource FormCheckBoxStyle}" />

                        <StackPanel IsEnabled="{Binding AutoInsertFrontMatter}">
                            <Label Content="è¿½åŠ ã§æŒ¿å…¥ã™ã‚‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£" Style="{StaticResource FormLabelStyle}" />
                            <Border Style="{StaticResource PropertyGridContainerStyle}">
                                <StackPanel>
                                    <ItemsControl ItemTemplate="{StaticResource SettingsFrontMatterPropertyTemplate}" ItemsSource="{Binding DefaultFrontMatterProperties}" />
                                    <Button HorizontalAlignment="Left"
                                            Command="{Binding AddFrontMatterPropertyCommand}"
                                            Style="{StaticResource IconButtonStyle}">
                                        <StackPanel Orientation="Horizontal">
                                            <Path Width="10"
                                                  Height="10"
                                                  Margin="0,0,5,0"
                                                  Data="{StaticResource AddIconGeometry}"
                                                  Fill="{StaticResource BrandPrimaryBrush}"
                                                  Stretch="Uniform" />
                                            <TextBlock FontSize="11"
                                                       FontWeight="Bold"
                                                       Foreground="{StaticResource BrandPrimaryBrush}"
                                                       Text="ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’è¿½åŠ " />
                                        </StackPanel>
                                    </Button>
                                </StackPanel>
                            </Border>
                            <TextBlock Margin="5,5,0,12"
                                       LineHeight="16"
                                       Style="{StaticResource AnnotationTextStyle}">
                                <Run Text="â€»ä½¿ç”¨å¯èƒ½ãªãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼:" />
                                <LineBreak />
                                <Run Text="  {Now} : ç¾åœ¨æ—¥æ™‚ (yyyy-MM-dd HH:mm:ss)" />
                                <LineBreak />
                                <Run Text="  {Date} : ç¾åœ¨æ—¥ä»˜ (yyyy-MM-dd)" />
                                <LineBreak />
                                <Run Text="  {Time} : ç¾åœ¨æ™‚åˆ» (HH:mm:ss)" />
                            </TextBlock>
                        </StackPanel>
                    </StackPanel>

                    <!-- Image Settings -->
                    <StackPanel Visibility="{Binding CurrentCategory, Converter={StaticResource ComparisonConverter}, ConverterParameter={x:Static vm:SettingsCategory.Image}}">
                        <Label Content="ç”»åƒè²¼ã‚Šä»˜ã‘è¨­å®š" Style="{StaticResource FirstSectionHeaderLabelStyle}" />

                        <Label Content="ä¿å­˜å…ˆãƒ•ã‚©ãƒ«ãƒ€ (ç›¸å¯¾ãƒ‘ã‚¹)" Style="{StaticResource FormLabelStyle}" />
                        <TextBox Style="{StaticResource FormTextBoxMediumStyle}" Text="{Binding ImageSaveDirectory}" />
                        <TextBlock Style="{StaticResource AnnotationTextStyle}" Text="â€»Markdownãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ã®ç›¸å¯¾ãƒ‘ã‚¹ã€‚ä¾‹: images" />

                        <Label Content="ãƒ•ã‚¡ã‚¤ãƒ«åãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ" Style="{StaticResource FormLabelStyle}" />
                        <TextBox Style="{StaticResource FormTextBoxMediumStyle}" Text="{Binding ImageFileNameTemplate}" />
                        <TextBlock Style="{StaticResource AnnotationTextStyle}" Text="â€»ä½¿ç”¨å¯èƒ½ãªå¤‰æ•°: {Date}, {Time}, {FileName}" />
                    </StackPanel>

                    <!-- Code Highlight Settings -->
                    <StackPanel Visibility="{Binding CurrentCategory, Converter={StaticResource ComparisonConverter}, ConverterParameter={x:Static vm:SettingsCategory.Code}}">
                        <Label Content="ã‚³ãƒ¼ãƒ‰ãƒã‚¤ãƒ©ã‚¤ãƒˆè¨­å®š" Style="{StaticResource FirstSectionHeaderLabelStyle}" />

                        <Label Content="ã‚³ãƒ¼ãƒ‰ãƒã‚¤ãƒ©ã‚¤ãƒˆ ãƒ†ãƒ¼ãƒž" Style="{StaticResource FormLabelStyle}" />
                        <ComboBox ItemsSource="{Binding AvailableThemes}"
                                  SelectedItem="{Binding SelectedCodeBlockTheme}"
                                  Style="{StaticResource FormComboBoxMediumStyle}" />
                        <TextBlock Style="{StaticResource AnnotationTextStyle}" Text="â€»ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã«é©ç”¨ã•ã‚Œã‚‹ highlight.js ã®ãƒ†ãƒ¼ãƒžã‚’é¸æŠžã—ã¾ã™ã€‚" />

                        <CheckBox Content="CSSã‚¨ãƒ‡ã‚£ã‚¿ã®è¨­å®šã§ãƒ†ãƒ¼ãƒžã‚’ä¸Šæ›¸ãã™ã‚‹"
                                  IsChecked="{Binding UseCustomCodeBlockStyle}"
                                  Style="{StaticResource FormCheckBoxStyle}" />
                        <TextBlock Margin="25,-12,0,20"
                                   HorizontalAlignment="Left"
                                   LineHeight="15"
                                   Style="{StaticResource AnnotationTextStyle}"
                                   Text="â€»ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã¨ã€CSSã‚¨ãƒ‡ã‚£ã‚¿ã®ã€Œã‚³ãƒ¼ãƒ‰ã€ã‚¿ãƒ–ã§ã®è¨­å®šãŒã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã«å¼·åˆ¶é©ç”¨ã•ã‚Œã¾ã™ã€‚" />

                        <Label Content="ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ˆHighlight.js / Mermaidï¼‰èª­ã¿è¾¼ã¿å…ˆ" Style="{StaticResource SectionHeaderLabelStyle}" />
                        <StackPanel Margin="5,0,0,10" Orientation="Horizontal">
                            <CheckBox IsChecked="{Binding IsCdnEnabled}" Style="{StaticResource ModernSwitchStyle}" />
                            <TextBlock Margin="10,0,0,0" VerticalAlignment="Center">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Text" Value="ãƒ­ãƒ¼ã‚«ãƒ«" />
                                        <Setter Property="Foreground" Value="{StaticResource TextSecondaryBrush}" />
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsCdnEnabled}" Value="True">
                                                <Setter Property="Text" Value="CDN" />
                                                <Setter Property="Foreground" Value="{StaticResource BrandPrimaryBrush}" />
                                                <Setter Property="FontWeight" Value="Bold" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                        </StackPanel>
                        <TextBlock Margin="5,15,0,0"
                                   Style="{StaticResource AnnotationTextStyle}"
                                   Text="â€»CDNã‚’é¸æŠžã™ã‚‹ã¨ã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆçµŒç”±ã§æœ€æ–°ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’èª­ã¿è¾¼ã¿ã¾ã™ï¼ˆã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ™‚ã¯è¡¨ç¤ºã§ãã¾ã›ã‚“ï¼‰ã€‚" />
                    </StackPanel>

                    <!-- Diagnostic Settings -->
                    <StackPanel Visibility="{Binding CurrentCategory, Converter={StaticResource ComparisonConverter}, ConverterParameter={x:Static vm:SettingsCategory.Diagnostic}}">
                        <Label Content="è¨ºæ–­ãƒ»ãƒ­ã‚°è¨­å®š" Style="{StaticResource FirstSectionHeaderLabelStyle}" />

                        <Label Content="ãƒ­ã‚°å‡ºåŠ›ãƒ¬ãƒ™ãƒ«" Style="{StaticResource FormLabelStyle}" />
                        <ComboBox ItemsSource="{Binding AvailableLogLevels}"
                                  SelectedItem="{Binding MinimumLogLevel}"
                                  Style="{StaticResource FormComboBoxMediumStyle}" />
                        <TextBlock Style="{StaticResource AnnotationTextStyle}" Text="â€»å‡ºåŠ›ã•ã‚Œã‚‹ãƒ­ã‚°ã®æœ€å°ãƒ¬ãƒ™ãƒ«ã‚’æŒ‡å®šã—ã¾ã™ã€‚" />

                        <CheckBox Content="ãƒ­ã‚°ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹"
                                  IsChecked="{Binding EnableFileLogging}"
                                  Style="{StaticResource FormCheckBoxStyle}" />
                        <TextBlock Style="{StaticResource AnnotationTextStyle}" Text="â€»ãƒ­ã‚°ã‚’ logs ãƒ•ã‚©ãƒ«ãƒ€å†…ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã™ã€‚" />
                    </StackPanel>
                </Grid>
            </ScrollViewer>

            <!-- Footer Buttons -->
            <StackPanel Grid.Row="1"
                        Grid.Column="1"
                        Margin="0,0,25,20"
                        HorizontalAlignment="Right"
                        Orientation="Horizontal">
                <Button Width="90"
                        Command="{Binding SaveCommand}"
                        Content="ä¿å­˜"
                        IsDefault="True"
                        Style="{StaticResource PrimaryButtonStyle}" />
                <Button Width="90"
                        Margin="12,0,0,0"
                        Command="{Binding CancelCommand}"
                        Content="ã‚­ãƒ£ãƒ³ã‚»ãƒ«"
                        IsCancel="True"
                        Style="{StaticResource SecondaryButtonStyle}" />
            </StackPanel>
        </Grid>
    </Border>
</Window>
